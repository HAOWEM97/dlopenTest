#include "usbcanfd.h"

usbcanfd::ZLGCanFuncs usbcanfd::funs;
usbcanfd::tagZLGCanFuncs::tagZLGCanFuncs()
{
    this->VCI_OpenDevice = NULL;
}

usbcanfd::usbcanfd(QObject *parent)
    : QObject{parent}
{
    QString dllPath = "./libusbcanfd.so";
    void* handle = dlopen( dllPath.toStdString().c_str(),RTLD_LAZY);
    if(nullptr == handle){
        qInfo()<<"Open lib failed! error:"<< dlerror();
        return;
    }else{
        void *ptr =dlsym(handle,"VCI_OpenDevice");
        if (ptr == nullptr){
            qInfo()<< "Con't find getPath function!";
        }else{
            qInfo()<< "get the function";
            memcpy(&funs.VCI_OpenDevice,&ptr,sizeof(ptr));
        }
    }
    dlclose(handle);

}
